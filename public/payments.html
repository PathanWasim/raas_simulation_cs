<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RaaS Simulation ‚Äî Payments</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
  <div class="matrix-bg"></div>

  <nav class="sidebar">
    <div class="sidebar-header">
      <div class="logo">
        <span class="logo-icon">‚ö°</span>
        <span class="logo-text">RaaS</span>
        <span class="logo-subtitle">SIMULATION</span>
      </div>
    </div>

    <div class="nav-menu">
      <div class="nav-section">
        <h3 class="nav-section-title">OPERATIONS</h3>
        <a href="dashboard.html" class="nav-item">
          <span class="nav-icon">üìä</span>
          <span class="nav-text">Dashboard</span>
        </a>
        <a href="campaigns.html" class="nav-item">
          <span class="nav-icon">üéØ</span>
          <span class="nav-text">Campaigns</span>
        </a>
        <a href="victims.html" class="nav-item">
          <span class="nav-icon">üë•</span>
          <span class="nav-text">Victims</span>
        </a>
        <a href="payments.html" class="nav-item active">
          <span class="nav-icon">üí∞</span>
          <span class="nav-text">Payments</span>
        </a>
      </div>

      <div class="nav-section">
        <h3 class="nav-section-title">ANALYTICS</h3>
        <a href="network.html" class="nav-item">
          <span class="nav-icon">üï∏Ô∏è</span>
          <span class="nav-text">Network Graph</span>
        </a>
        <a href="timeline.html" class="nav-item">
          <span class="nav-icon">‚è±Ô∏è</span>
          <span class="nav-text">Timeline</span>
        </a>
        <a href="logs.html" class="nav-item">
          <span class="nav-icon">üìã</span>
          <span class="nav-text">Logs</span>
        </a>
      </div>

      <div class="nav-section">
        <h3 class="nav-section-title">SYSTEM</h3>
        <a href="defense.html" class="nav-item">
          <span class="nav-icon">üõ°Ô∏è</span>
          <span class="nav-text">Blue Team Mode</span>
        </a>
        <a href="reports.html" class="nav-item">
          <span class="nav-icon">üìÑ</span>
          <span class="nav-text">Reports</span>
        </a>
        <a href="about.html" class="nav-item">
          <span class="nav-icon">‚ÑπÔ∏è</span>
          <span class="nav-text">About</span>
        </a>
      </div>
    </div>
  </nav>

  <main class="main-content">
    <header class="dashboard-header">
      <div class="header-left">
        <h1 class="dashboard-title">PAYMENT CONSOLE</h1>
        <p class="dashboard-subtitle">Demands, statuses, and receipts</p>
      </div>
      <div class="header-right">
        <div class="status-indicators">
          <div class="status-item">
            <span class="status-dot active"></span>
            <span class="status-text">PAYMENTS LIVE</span>
          </div>
          <div class="status-item">
            <span class="status-dot warning"></span>
            <span class="status-text">SIMULATION MODE</span>
          </div>
        </div>
        <div class="header-actions">
          <button class="btn btn-primary" id="refresh-payments"><span class="btn-icon">üîÑ</span> REFRESH</button>
          <a class="btn btn-secondary" href="dashboard.html"><span class="btn-icon">üè†</span> DASHBOARD</a>
          <button class="btn btn-secondary" id="new-payment"><span class="btn-icon">‚ûï</span> CREATE DEMAND</button>
        </div>
      </div>
    </header>

    <div class="active-campaigns">
      <div class="section-header">
        <h3>PAYMENT DEMANDS</h3>
      </div>
      <div class="campaigns-grid" id="payments-grid"></div>
    </div>

    <footer class="dashboard-footer">
      <div class="footer-info">
        <span class="footer-text">Educational RaaS Simulation ‚Ä¢ Safe & Non-Malicious</span>
        <span class="footer-time" id="last-updated">Last updated: Never</span>
      </div>
    </footer>
  </main>

  <script>
    async function fetchJSON(url, opts) {
      const res = await fetch(url, opts);
      if (!res.ok) throw new Error('Request failed');
      return res.json();
    }

    function showToast(msg, ok) {
      const d = document.createElement('div');
      d.textContent = msg;
      d.style.cssText = 'position:fixed;top:16px;right:16px;' + (ok ? 'background:#00ff88;color:#0b0b0c' : 'background:#1a1a1acc;color:#fff') + ';padding:10px 14px;border-radius:10px;z-index:9999;font:600 12px Inter,system-ui,Arial';
      document.body.appendChild(d);
      setTimeout(() => d.remove(), 2000);
    }

    async function loadPayments() {
      try {
        const payments = await fetchJSON('/api/payments');
        const grid = document.getElementById('payments-grid');
        grid.innerHTML = payments.map(p => `
          <div class="campaign-card">
            <div class="campaign-header">
              <h5>${p.victim || 'anonymous'}</h5>
              <span class="campaign-status ${p.paid ? 'completed' : 'active'}">${p.paid ? 'PAID' : 'UNPAID'}</span>
            </div>
            <div class="campaign-stats">
              <div class="stat"><span class="stat-label">Amount:</span><span class="stat-value">${Number(p.amount || 0).toFixed(4)} BTC</span></div>
              <div class="stat"><span class="stat-label">Payment ID:</span><span class="stat-value">${p.id}</span></div>
              <div class="stat"><span class="stat-label">Address:</span><span class="stat-value">FAKE-CRYPTO-ADDRESS-${p.id}</span></div>
              <div class="stat"><span class="stat-label">Created:</span><span class="stat-value">${new Date(p.created_at).toLocaleString()}</span></div>
            </div>
            <div class="campaign-actions">
              ${p.paid ? '' : `<button class="btn btn-small btn-secondary" onclick="markPaid(${p.id})">MARK PAID</button>`}
            </div>
          </div>
        `).join('');
        document.getElementById('last-updated').textContent = 'Last updated: ' + new Date().toLocaleTimeString();
      } catch (e) { showToast('Failed to load payments'); }
    }

    async function markPaid(id) {
      try {
        await fetchJSON('/api/payment/mark-paid', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ id }) });
        showToast('Marked as paid', true);
        loadPayments();
      } catch (e) { showToast('Failed to mark as paid'); }
    }

    async function createDemand() {
      const victim = prompt('Victim ID (e.g., victim-001):', 'victim-001') || 'victim-001';
      const amount = Number(prompt('Amount (BTC):', '0.050') || '0.050');
      try {
        await fetchJSON('/api/payment/create', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ victim, amount }) });
        showToast('Demand created', true);
        loadPayments();
      } catch (e) { showToast('Failed to create demand'); }
    }

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('refresh-payments').addEventListener('click', loadPayments);
      document.getElementById('new-payment').addEventListener('click', createDemand);
      loadPayments();
    });
  </script>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <script>
    // Live updates via socket
    (function(){
      try {
        const socket = io();
        socket.on('payments-updated', (evt) => {
          loadPayments();
          try {
            if (evt && evt.status === 'paid' && window.timelineManager) {
              window.timelineManager.addPaidEvent?.(evt.id);
            }
          } catch {}
        });
      } catch(e) {}
    })();
  </script>
  <script src="demo.js"></script>
</body>
</html>


